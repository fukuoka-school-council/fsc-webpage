---
import Footer from "@/components/Footer.astro"
import Header from "@/components/Header.astro"
import Layout from "@/layouts/Layout.astro"

const locale = Astro.preferredLocale || Astro.currentLocale || "en"

const baseUrl = new URL(Astro.request.url)
const response = await fetch(`${baseUrl.origin}/api/news`)
const articles = await response.json()
---

<Layout title="News">
  <Header />
  <main>
    <h1>Latest News</h1>

    {
      articles.length > 0 ? (
        <div class="news-list">
          {articles.map(
            (article: {
              id: string;
              title: string;
              content: string;
              date: string;
            }) => (
              <article class="news-item">
                <h2>{article.title}</h2>
                <time datetime={article.date}>
                  {new Date(article.date).toLocaleDateString(locale)}
                </time>
                <p>{article.content}</p>
              </article>
            ),
          )}
        </div>
      ) : (
        <p>No news articles yet.</p>
      )
    }
  </main>
  <Footer />
</Layout>

<style>
  .news-list {
    display: grid;
    gap: 2rem;
    margin-bottom: 3rem;
  }

  .news-item {
    border-bottom: 1px solid #eee;
    padding-bottom: 1rem;
  }

  .news-item time {
    color: #666;
    font-size: 0.9rem;
    display: block;
    margin-bottom: 0.5rem;
  }

  form {
    margin-top: 3rem;
    padding: 1.5rem;
    background: #f5f5f5;
    border-radius: 8px;
  }

  form div {
    margin-bottom: 1rem;
  }

  label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
  }

  input,
  textarea {
    width: 100%;
    padding: 0.5rem;
    border: 1px solid #ddd;
    border-radius: 4px;
  }

  textarea {
    min-height: 150px;
  }

  button {
    background: #0067b2;
    color: white;
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }
</style>
