---
import Footer from "@/components/Footer.astro"
import Header from "@/components/Header.astro"
import articles from "@/data/news.json"
import Layout from "@/layouts/Layout.astro"
import t from "@/utils/i18n"

const locale =
	(Astro.preferredLocale || Astro.currentLocale) === "ja" ? "ja" : "en"
---

<Layout title={t("news.title", locale)}>
  <Header />
  <main>
    <h1>{t("news.title", locale)}</h1>

    {
      articles.length > 0 ? (
        <div class="news-list">
          {articles.reverse().map(
            (article: {
              id: string,
              en: {
                title: string,
                content: string,
              },
              ja: {
                title: string,
                content: string,
              },
              date: string,
              author: {
                name: string,
                icon: string,
              },
            }) => (
              <article class="news-item">
                <h2>
                  {article[locale].title ||
                    article[locale === "ja" ? "en" : "ja"].title}
                </h2>

                <time datetime={article.date}>
                  {new Date(article.date).toLocaleDateString(locale)}
                </time>
                <div class="author">
                  <img
                    src={article.author.icon}
                    alt={article.author.name}
                    width="24"
                    height="24"
                  />
                  <span>{article.author.name}</span>
                </div>
                {(
                  article[locale].content ||
                  article[locale === "ja" ? "en" : "ja"].content
                )
                  .split("\n")
                  .map((paragraph) => (
                    <p>{paragraph}</p>
                  ))}
              </article>
            ),
          )}
        </div>
      ) : (
        <p>{t("news.noArticles", locale)}</p>
      )
    }
  </main>
  <Footer />
</Layout>

<style>
  .news-list {
    display: grid;
    gap: 2rem;
    margin-bottom: 3rem;
  }

  .news-item {
    border-bottom: 1px solid #eee;
    padding-bottom: 1rem;
  }

  .news-item time {
    color: #666;
    font-size: 0.9rem;
    display: block;
    margin-bottom: 0.5rem;
  }

  .author {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
  }

  .author img {
    border-radius: 50%;
  }

  form {
    margin-top: 3rem;
    padding: 1.5rem;
    background: #f5f5f5;
    border-radius: 8px;
  }

  form div {
    margin-bottom: 1rem;
  }

  label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
  }

  input,
  textarea {
    width: 100%;
    padding: 0.5rem;
    border: 1px solid #ddd;
    border-radius: 4px;
  }

  textarea {
    min-height: 150px;
  }

  button {
    background: #0067b2;
    color: white;
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }
</style>
